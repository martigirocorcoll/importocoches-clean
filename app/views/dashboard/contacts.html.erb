<div class="dashboard-header" style="margin-bottom: 30px;">
  <h1 style="color: #2c3e50; font-size: 28px; margin-bottom: 10px;">
    <i class="fa-solid fa-address-book"></i> Contactos
  </h1>
  <p style="color: #7f8c8d;">Todos los contactos creados desde formularios y WhatsApp</p>
</div>

<div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px;">
  <div class="row">
    <div class="col-md-3">
      <div class="card text-center">
        <div class="card-body">
          <h5 class="card-title text-primary"><%= @total_contacts %></h5>
          <p class="card-text">Total contactos</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center">
        <div class="card-body">
          <h5 class="card-title text-info"><%= @contacts_this_month %></h5>
          <p class="card-text">Este mes</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center">
        <div class="card-body">
          <h5 class="card-title text-success"><%= @whatsapp_contacts %></h5>
          <p class="card-text">WhatsApp</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center">
        <div class="card-body">
          <h5 class="card-title text-warning"><%= @form_contacts %></h5>
          <p class="card-text">Formularios</p>
        </div>
      </div>
    </div>
  </div>
</div>

<div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h5 style="color: #2c3e50; margin: 0;">Lista de Contactos</h5>
    
    <form method="get" class="form-inline">
      <div class="input-group">
        <input type="text" 
               class="form-control" 
               name="search" 
               value="<%= params[:search] %>" 
               placeholder="Buscar contactos..."
               style="min-width: 250px;">
        <div class="input-group-append">
          <button class="btn btn-outline-primary" type="submit">
            <i class="fa-solid fa-search"></i>
          </button>
        </div>
      </div>
    </form>
  </div>

  <div class="table-responsive">
    <table class="table table-striped table-sm">
      <thead>
        <tr>
          <th>Referencia</th>
          <th>Nombre</th>
          <th>Email</th>
          <th>Teléfono</th>
          <th>Fuente</th>
          <th>Campaña</th>
          <th>Página</th>
          <th>Fecha</th>
          <th>Usuario</th>
        </tr>
      </thead>
      <tbody>
        <% @contacts.each do |contact| %>
          <tr>
            <td>
              <strong style="color: #3498db;">
                <%= contact.reference_number || contact.id %>
              </strong>
            </td>
            <td><%= contact.name %></td>
            <td><%= contact.email %></td>
            <td>
              <% if contact.phone == 'pending-whatsapp' %>
                <span class="badge badge-success">
                  <i class="fa-brands fa-whatsapp"></i> WhatsApp
                </span>
              <% else %>
                <%= contact.phone %>
              <% end %>
            </td>
            <td><%= contact.source&.capitalize %></td>
            <td>
              <% if contact.utm_params.present? %>
                <span class="badge badge-primary" title="<%= contact.utm_params %>">
                  <i class="fa-solid fa-chart-line"></i> UTM
                </span>
              <% else %>
                <span class="badge badge-secondary">
                  Directo
                </span>
              <% end %>
            </td>
            <td>
              <% if contact.page_url.present? %>
                <small style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; display: block;">
                  <a href="<%= contact.page_url %>" target="_blank" class="text-info">
                    <%= contact.page_url.gsub(/https?:\/\/[^\/]+/, '').truncate(40) %>
                    <i class="fa-solid fa-external-link-alt fa-xs"></i>
                  </a>
                </small>
              <% else %>
                <span class="text-muted">-</span>
              <% end %>
            </td>
            <td><%= contact.created_at.strftime("%d/%m %H:%M") %></td>
            <td>
              <% if contact.user %>
                <%= link_to admin_user_path(contact.user), 
                    class: "text-primary", target: "_blank" do %>
                  <i class="fa-solid fa-user"></i> <%= contact.user.id %>
                <% end %>
              <% else %>
                <span class="text-muted">Anónimo</span>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  
  <div class="mt-3 d-flex justify-content-between">
    <small class="text-muted">
      Mostrando <%= @contacts.count %> de <%= @total_count %> contactos
      <% if params[:search].present? %>
        (filtrado por "<%= params[:search] %>")
      <% end %>
    </small>
    
    <div class="pagination-info">
      <small class="text-muted">
        Página <%= @current_page %> de <%= @total_pages %>
      </small>
    </div>
  </div>
</div>